apiVersion: v1
kind: Pod
metadata:
  generateName: mlperf-cosmoflow-4-nvidia-a100-sxm4-40gb-wlow-
spec:
  containers:
  - args:
    - --nproc_per_node=4
    - train.py
    - -lbs
    - '64'
    - -c
    - /workspace/ML_HPC/CosmoFlow/Torch/config.yaml
    command:
    - torchrun
    env:
    - name: OMP_NUM_THREADS
      value: '4'
    image: bigballoon8/mlperf-epcc
    name: mlperf-cosmoflow-4-nvidia-a100-sxm4-40gb-wlow
    resources:
      limits:
        cpu: 16
        memory: 32Gi
        nvidia.com/gpu: 4
      requests:
        cpu: 16
        memory: 16Gi
    volumeMounts:
    - mountPath: /mnt/ceph_rbd
      name: volume
    - mountPath: /dev/shm
      name: devshm
    workingDir: /workspace/ML_HPC/CosmoFlow/Torch
  nodeSelector:
    nvidia.com/gpu.product: NVIDIA-A100-SXM4-40GB
  restartPolicy: Never
  volumes:
  - name: volume
    persistentVolumeClaim:
      claimName: cosmoflow-pvc
  - emptyDir:
      medium: Memory
    name: devshm
